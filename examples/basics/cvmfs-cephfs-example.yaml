# sparkoperator chart needs to be installed with CVMFS/CephFS enabled:
# helm install https://gitlab.cern.ch/db/spark-service/spark-service-charts/raw/master/cern-sparkoperator-0.1.0.tgz

apiVersion: "sparkoperator.k8s.io/v1alpha1"
kind: SparkApplication
metadata:
  name: spark-pi
  namespace: default
spec:
  type: Scala
  mode: cluster
  image: gitlab-registry.cern.ch/db/spark-service/spark-k8s-examples:v2.4.0-hadoop3.1-examples
  imagePullPolicy: Always
  mainClass: ch.cern.sparkrootapplications.examples.SparkPi
  mainApplicationFile: local:///opt/spark/examples/jars/spark-service-examples_2.11-0.3.0.jar
  mode: cluster
  volumes:
    - name: cephfs
      persistentVolumeClaim:
        claimName: manila-cephfs-pvc
    - name: cvmfs-cms
      persistentVolumeClaim:
        claimName: cvmfs-cms-cern-ch
    - name: cvmfs-sft
      persistentVolumeClaim:
        claimName: cvmfs-sft-cern-ch
  driver:
    cores: 1
    coreLimit: "1000m"
    memory: "1024m"
    labels:
      version: 2.4.0
    serviceAccount: spark
    volumeMounts:
  executor:
    instances: 1
    cores: 1
    memory: "1024m"
    labels:
      version: 2.4.0
    volumeMounts:
      - name: cvmfs-cms
        mountPath: /cvmfs/cms.cern.ch
      - name: cvmfs-sft
        mountPath: /cvmfs/sft.cern.ch
      - name: cephfs
        mountPath: /cephfs
  restartPolicy: Never
